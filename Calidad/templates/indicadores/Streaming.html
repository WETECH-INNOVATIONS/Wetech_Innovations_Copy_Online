{% extends 'base/index.html' %}

{% load static %}

{% block meta %}
<base href="../../../">
<meta charset="utf-8" />
<meta name="description" content="Datatable HTML table" />
<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no" />
{% endblock meta %}

{% block titulo %}
    <title>Streaming</title>
{% endblock titulo %}

{% block scripts_local %}

	<script src="{% static 'highcharts/highcharts.js' %}"></script>
	<script src="{% static 'highcharts/modules/exporting.js' %}"></script>
	<script src="{% static 'highcharts/modules/export-data.js' %}"></script>
	<script src="{% static 'highcharts/modules/accessibility.js' %}"></script>
{% endblock scripts_local %}

{% block content %}
    <div class="d-flex flex-column-fluid m-4">
    	<div class="container mt-4">
    		<div class="row">
    			<div class="col-lg-12">
    				
    				<div class="card card-custom card-stretch gutter-b">
    					
    					<div class="card-header border-0 pb-6 pt-6">
    					    
    					    <a class= "btn btn-white border border-primary" href= "{% url 'api_bi' %}" > <span class="pulse-ring"></span>
    					        <div class="row">
    					            <div class="col-lg-8 align-self-center">
                                       Iniciar Streaming
                                    </div>
                                    
                                    <div class="col-sm-4">
                                        <div class="topbar-item" data-toggle="dropdown" data-offset="10px,0px">
        										<div class="btn btn-icon btn-clean btn-dropdown btn-lg pulse pulse-primary">
        											<span class="svg-icon svg-icon-primary svg-icon-2x"><!--begin::Svg Icon | path:/var/www/preview.keenthemes.com/keen/releases/2020-10-07-041015/theme/demo1/dist/../src/media/svg/icons/Devices/LTE1.svg--><svg xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" width="24px" height="24px" viewBox="0 0 24 24" version="1.1">
                                                        <g stroke="none" stroke-width="1" fill="none" fill-rule="evenodd">
                                                            <rect x="0" y="0" width="24" height="24"/>
                                                            <path d="M15.4508979,17.4029496 L14.1784978,15.8599014 C15.324501,14.9149052 16,13.5137472 16,12 C16,10.4912085 15.3289582,9.09418404 14.1893841,8.14910121 L15.466112,6.60963188 C17.0590936,7.93073905 18,9.88958759 18,12 C18,14.1173586 17.0528606,16.0819686 15.4508979,17.4029496 Z M18.0211112,20.4681628 L16.7438102,18.929169 C18.7927036,17.2286725 20,14.7140097 20,12 C20,9.28974232 18.7960666,6.77820732 16.7520315,5.07766256 L18.031149,3.54017812 C20.5271817,5.61676443 22,8.68922234 22,12 C22,15.3153667 20.523074,18.3916375 18.0211112,20.4681628 Z M8.54910207,17.4029496 C6.94713944,16.0819686 6,14.1173586 6,12 C6,9.88958759 6.94090645,7.93073905 8.53388797,6.60963188 L9.81061588,8.14910121 C8.67104182,9.09418404 8,10.4912085 8,12 C8,13.5137472 8.67549895,14.9149052 9.82150222,15.8599014 L8.54910207,17.4029496 Z M5.9788888,20.4681628 C3.47692603,18.3916375 2,15.3153667 2,12 C2,8.68922234 3.47281829,5.61676443 5.96885102,3.54017812 L7.24796852,5.07766256 C5.20393339,6.77820732 4,9.28974232 4,12 C4,14.7140097 5.20729644,17.2286725 7.25618985,18.929169 L5.9788888,20.4681628 Z" fill="#000000" fill-rule="nonzero" opacity="0.3"/>
                                                            <circle fill="#000000" cx="12" cy="12" r="2"/>
                                                        </g>
                                                    </svg><!--end::Svg Icon--></span>
        											<span class="pulse-ring"></span>
        										</div>
        							    </div>
                                    </div>
                                </div>
    					    </a>
						</div>
						 
    					<!-- <div>
                            <iframe width="600" height="373.5" src="https://app.powerbi.com/view?r=eyJrIjoiZmY0ZjIwNWUtZmFkNS00MDRkLWIyZTUtY2IzNDRjMzQxMjU1IiwidCI6ImE5NDRjNDY2LTczNGItNGJkNC04Y2Q4LWM3N2Q1MjlhMzE1MCJ9&pageName=ReportSection" frameborder="0" allowFullScreen="true"></iframe>
						</div>
						 -->
						<div id="container_streaming"> 

						</div>

    				</div>
    			</div>
			</div>
			
			<div class="row">
    			<div class="col-lg-12">
    				
    				<div class="card card-custom card-stretch gutter-b">

						<div id="container"> 

						</div>

    				</div>
    			</div>
    		</div>
    	</div>
	</div>
	

	<script>
		var graphcolumn = Highcharts.chart('container', {
            chart: {
                type: 'column'
            },
            title: {
                text: 'Reporte de ventas del a√±o 2020'
            },
            subtitle: {
                text: 'Reporte de columnas'
            },
            xAxis: {
                categories: [
                    'Enero',
                    'Febrero',
                    'Marzo',
                    'Abril',
                    'Mayo',
                    'Junio',
                    'Julio',
                    'Agosto',
                    'Septiembre',
                    'Octubre',
                    'Noviembre',
                    'Diciembre'
                ],
                crosshair: true
            },
            yAxis: {
                min: 0,
                title: {
                    text: 'Valores $'
                }
            },
            tooltip: {
                headerFormat: '<span style="font-size:10px">{point.key}</span><table>',
                pointFormat: '<tr><td style="color:{series.color};padding:0">{series.name}: </td>' +
                    '<td style="padding:0"><b>{point.y:.1f} $</b></td></tr>',
                footerFormat: '</table>',
                shared: true,
                useHTML: true
            },
            plotOptions: {
                column: {
                    pointPadding: 0.2,
                    borderWidth: 0
                }
            },
        });
	
		function get_graph_sales_year_month() {
            $.ajax({
                url: window.location.pathname, //window.location.pathname
                type: 'POST',
                data: {
                    'action': 'get_graph_sales_year_month'
                },
                dataType: 'json',
            }).done(function (data) {
                if (!data.hasOwnProperty('error')) {
                    graphcolumn.addSeries(data);
                    return false;
                }
                message_error(data.error);
            }).fail(function (jqXHR, textStatus, errorThrown) {
                alert(textStatus + ': ' + errorThrown);
            }).always(function (data) {

            });
        }


		Highcharts.chart('container_streaming', {
			chart: {
				type: 'spline',
				animation: Highcharts.svg, // don't animate in old IE
				marginRight: 10,
				events: {
					load: function () {

						// set up the updating of the chart each second
						var series = this.series[0];
						setInterval(function () {
							var x = (new Date()).getTime(), // current time
								y = Math.random();
							series.addPoint([x, y], true, true);
						}, 1000);
					}
				}
			},

			time: {
				useUTC: false
			},

			title: {
				text: 'Live random data'
			},

			accessibility: {
				announceNewData: {
					enabled: true,
					minAnnounceInterval: 15000,
					announcementFormatter: function (allSeries, newSeries, newPoint) {
						if (newPoint) {
							return 'New point added. Value: ' + newPoint.y;
						}
						return false;
					}
				}
			},

			xAxis: {
				type: 'datetime',
				tickPixelInterval: 150
			},

			yAxis: {
				title: {
					text: 'Value'
				},
				plotLines: [{
					value: 0,
					width: 1,
					color: '#808080'
				}]
			},

			tooltip: {
				headerFormat: '<b>{series.name}</b><br/>',
				pointFormat: '{point.x:%Y-%m-%d %H:%M:%S}<br/>{point.y:.2f}'
			},

			legend: {
				enabled: false
			},

			exporting: {
				enabled: false
			},

			series: [{
				name: 'Random data',
				data: (function () {
					// generate an array of random data
					var data = [],
					time = (new Date()).getTime(),
					i;

					for (i = -19; i <= 0; i += 1) {
						data.push({
							x: time + i * 1000,
							y: Math.random()
						});
						console.log(data)
					}
					return data;
				}())
			}]
		});


		$(function () {
			get_graph_sales_year_month();
		});

	
	</script>
{% endblock content %}			